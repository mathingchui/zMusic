<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸŽ§ 1991 â€” For Her (Ultra Dark Premium) â€” Scrub Slider</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-black: #030305;
    --card-bg: rgba(255,255,255,0.04);
    --card-border: rgba(255,255,255,0.06);
    --glass-blur: 8px;
    --accent: #ffffff;
    --muted: rgba(255,255,255,0.6);
    --vinyl-size: 110px;
    --thumb-size: 14px;
  }

  /* Reset */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--bg-black);
    color: var(--accent);
    overflow:hidden;
  }

  /* Background */
  .bg-wrap{ position:fixed; inset:0; z-index:-6; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .bg-image { max-width:100vw; max-height:100vh; width:auto; height:auto; object-fit:contain; display:block; filter:grayscale(100%) contrast(1.05) brightness(0.9); transform-origin:center; }
  .bg-fill { position:fixed; inset:0; z-index:-8; background-position:center; background-size:cover; filter: blur(34px) brightness(0.5) grayscale(100%); transform: scale(1.02); }
  .vignette { position:fixed; inset:0; z-index:-7; pointer-events:none; background: radial-gradient(ellipse at center, rgba(0,0,0,0) 40%, rgba(0,0,0,0.6) 100%); }

  .overlay { position:fixed; inset:0; z-index:-5; background: linear-gradient(0deg, rgba(0,0,0,0.45), rgba(0,0,0,0.15)); pointer-events:none; }

  /* Page */
  .page { position:relative; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:18px; min-height:100vh; padding:48px 20px; }

  header{ margin-top:22px; text-align:center; z-index:2; display:flex; flex-direction:column; gap:8px; align-items:center; }
  h1{ font-family: "Playfair Display", serif; font-weight:700; letter-spacing:0.6px; font-size:42px; color:var(--accent); text-shadow: 0 6px 28px rgba(0,0,0,0.7); }
  .subtitle{ font-size:14px; color:var(--muted); font-weight:300; letter-spacing:0.4px; }

  .player-shell{ width:100%; max-width:900px; display:grid; grid-template-columns: auto 1fr; gap:18px; align-items:center; margin-top:18px; z-index:2; }

  .card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius:16px; padding:18px; backdrop-filter: blur(var(--glass-blur)); box-shadow: 0 8px 30px rgba(0,0,0,0.6); }
  .album { width: var(--vinyl-size); height: var(--vinyl-size); display:flex; align-items:center; justify-content:center; border-radius:12px; overflow:visible; position:relative; margin:auto; }

  .vinyl { width: calc(var(--vinyl-size) * 0.92); height: calc(var(--vinyl-size) * 0.92); border-radius:50%; background: radial-gradient(circle at 35% 30%, #111 0%, #000 45%, #0a0a0a 100%); display:flex; align-items:center; justify-content:center; box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 8px 30px rgba(0,0,0,0.6); transition: transform 0.8s linear; }
  .vinyl.playing { animation: spin 4s linear infinite; }
  .vinyl .label { width: 42%; height: 42%; border-radius:50%; background: rgba(255,255,255,0.06); display:flex; align-items:center; justify-content:center; font-size:10px; color:var(--muted); text-align:center; padding:6px; transform: translateZ(0); }

  @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }

  .controls { display:flex; flex-direction:column; gap:12px; }
  .meta { display:flex; flex-direction:column; gap:6px; }
  .track-title { font-family:"Playfair Display", serif; font-weight:600; font-size:20px; color:var(--accent); }
  .track-sub { color:var(--muted); font-size:13px; }

  .btn { display:inline-flex; align-items:center; gap:10px; background:transparent; border:1px solid rgba(255,255,255,0.08); color:var(--accent); padding:10px 14px; border-radius:12px; cursor:pointer; transition: transform .15s ease, background .18s ease; font-weight:600; }
  .btn:active { transform: scale(.98) }
  .btn:hover { background: rgba(255,255,255,0.02) }

  /* --- Scrub slider (modern) --- */
  .scrub {
    margin-top:6px;
    width:100%;
    position:relative;
    height:28px;
    display:flex;
    align-items:center;
    gap:12px;
  }
  .time-left { min-width:44px; color:var(--muted); font-size:13px; text-align:left; }
  .time-right { min-width:44px; color:var(--muted); font-size:13px; text-align:right; }

  .track {
    position:relative;
    flex:1;
    height:8px;
    border-radius:8px;
    background: rgba(255,255,255,0.04);
    cursor:pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .track-filled {
    position:absolute; left:0; top:0; bottom:0; width:0%; border-radius:8px;
    background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.6));
    transition: width 0.08s linear;
  }
  /* thumb */
  .thumb {
    position:absolute;
    top:50%;
    transform: translate(-50%,-50%);
    width: var(--thumb-size);
    height: var(--thumb-size);
    border-radius:50%;
    background:white;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    border: 2px solid rgba(0,0,0,0.6);
    transition: transform .08s ease;
    touch-action: none;
  }
  .thumb.hidden { opacity:0; pointer-events:none; transform: translate(-50%,-50%) scale(0.7); }

  /* tooltip */
  .tooltip {
    position:absolute;
    bottom: 36px;
    transform: translateX(-50%);
    padding:6px 8px;
    background: rgba(0,0,0,0.8);
    color: #fff;
    font-size:12px;
    border-radius:6px;
    white-space:nowrap;
    pointer-events:none;
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    opacity:0;
    transition: opacity .12s ease, transform .12s ease;
  }
  .tooltip.visible { opacity:1; transform: translateX(-50%) translateY(-6px); }

  .visualizer { margin-top:12px; width:100%; height:80px; border-radius:10px; overflow:hidden; }

  .playlist { margin-top:18px; width:100%; max-width:900px; display:flex; flex-direction:column; gap:12px; z-index:2; }
  .song-row { display:flex; justify-content:space-between; align-items:center; padding:12px; border-radius:12px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.03); transition: transform .18s ease, background .18s ease; }
  .song-row:hover{ transform: translateY(-4px); background: rgba(255,255,255,0.032) }
  .song-info { display:flex; gap:12px; align-items:center; }
  .song-meta { display:flex; flex-direction:column; }
  .song-title { font-weight:600; color:var(--accent) }
  .song-artist { font-size:13px; color:var(--muted) }

  #nightToggle { position:fixed; top:18px; right:18px; z-index:9; background:transparent; border:1px solid rgba(255,255,255,0.07); padding:10px 12px; border-radius:10px; color:var(--accent); cursor:pointer; font-weight:600; }
  #nightToggle:hover { background: rgba(255,255,255,0.02) }

  canvas#particles { position:fixed; inset:0; z-index:-4; pointer-events:none; }

  body.night .bg-image{ opacity:0; transform: scale(0.98); transition: opacity .5s, transform .5s }
  body.night .bg-fill { filter: blur(2px) brightness(0.06) grayscale(100%) }
  body.night .overlay { background: rgba(0,0,0,0.9) }

  @media (max-width:880px){
    .player-shell{ grid-template-columns: 1fr; gap:14px; padding:0 8px }
    .album { margin:0 auto; }
  }
  @media (max-width:420px){
    h1{ font-size:28px }
    .subtitle{ font-size:12px }
    .time-left, .time-right { display:none }
  }
</style>
</head>
<body>

<!-- BACKGROUND -->
<div class="bg-wrap" aria-hidden="true">
  <div class="bg-fill" id="bgFill" style="background-image: url('herfavsongimage.jpg')"></div>
  <img class="bg-image" id="bgImage" src="herfavsongimage.jpg" alt="" />
  <div class="vignette"></div>
</div>

<!-- particles canvas -->
<canvas id="particles"></canvas>

<!-- overlay -->
<div class="overlay"></div>


<!-- PAGE -->
<div class="page">
  <header>
    <h1>1991</h1>
    <div class="subtitle">for her â€” cinematic edition</div>
  </header>

  <main style="width:100%;display:flex;flex-direction:column;align-items:center;">
    <div class="player-shell" style="width:100%;max-width:900px;">
      <!-- Left: album/vinyl -->
      <div class="card album" style="display:flex;align-items:center;justify-content:center;">
        <div class="vinyl" id="vinyl">
          <div class="label">for her</div>
        </div>
      </div>

      <!-- Right: controls & visualizer -->
      <div class="card controls" style="min-width:0;">
        <div class="meta">
          <div class="track-title">Take Me Back To 1991</div>
          <div class="track-sub">For You â€¢ 3:24</div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <button class="btn" id="playBtn" onclick="togglePlay()">â–¶ Play</button>

          <div style="flex:1;min-width:160px">
            <!-- Modern scrub slider -->
            <div class="scrub" id="scrub">
              <div class="time-left" id="timeLeft">0:00</div>
              <div class="track" id="track" aria-label="Seek bar" role="slider" aria-valuemin="0" aria-valuemax="100" tabindex="0">
                <div class="track-filled" id="trackFilled"></div>
                <div class="thumb hidden" id="thumb" aria-hidden="false"></div>
                <div class="tooltip" id="tooltip">0:00</div>
              </div>
              <div class="time-right" id="timeRight">0:00</div>
            </div>
          </div>

          <div style="width:48px;text-align:right;color:var(--muted);font-size:13px" id="timeDisplay">0:00</div>
        </div>

        <!-- Visualizer -->
        <div class="visualizer card" style="padding:8px;margin-top:12px;">
          <canvas id="vizCanvas" width="800" height="80" style="width:100%;height:80px;display:block"></canvas>
        </div>

        <!-- Hidden native audio element -->
        <audio id="player" src="herfavsong.mp3" preload="metadata"></audio>
      </div>
    </div>

    <!-- Playlist -->
    <div class="playlist">
      <div class="song-row card">
        <div class="song-info">
          <div style="width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center">â™ª</div>
          <div class="song-meta">
            <div class="song-title">Take Me Back To 1991</div>
            <div class="song-artist">For You</div>
          </div>
        </div>
        <div>
          <button class="btn" onclick="playTrack('herfavsong.mp3', this)">Play</button>
        </div>
      </div>
    </div>

  </main>
</div>

<script>
/* -------------------------
   Core elements & helpers
   ------------------------- */
const player = document.getElementById('player');
const playBtn = document.getElementById('playBtn');
const vinyl = document.getElementById('vinyl');
const timeDisplay = document.getElementById('timeDisplay');
const timeLeft = document.getElementById('timeLeft');
const timeRight = document.getElementById('timeRight');

const track = document.getElementById('track');
const trackFilled = document.getElementById('trackFilled');
const thumb = document.getElementById('thumb');
const tooltip = document.getElementById('tooltip');

let audioCtx, analyser, sourceNode, dataArray, rafId;
let isPlaying = false;
let dragging = false;

/* format time */
function formatTime(seconds) {
  if (!isFinite(seconds)) return '0:00';
  const m = Math.floor(seconds / 60);
  const s = Math.floor(seconds % 60).toString().padStart(2, '0');
  return `${m}:${s}`;
}

/* -------------------------
   Audio Context & Visualizer
   ------------------------- */
function ensureAudio() {
  if (audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  sourceNode = audioCtx.createMediaElementSource(player);
  sourceNode.connect(analyser);
  analyser.connect(audioCtx.destination);
  visualize();
}

/* play/pause */
function togglePlay() {
  if (!audioCtx) ensureAudio();
  if (player.paused) {
    player.play().catch(e=>console.warn(e));
  } else {
    player.pause();
  }
}

function playTrack(src, btn) {
  if (player.src.includes(src) && !player.paused) {
    player.pause();
  } else {
    if (!player.src.includes(src)) player.src = src;
    ensureAudio();
    player.play();
  }
}

/* update UI */
player.addEventListener('play', () => {
  isPlaying = true;
  playBtn.textContent = 'â¸ Pause';
  vinyl.classList.add('playing');
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
});
player.addEventListener('pause', () => {
  isPlaying = false;
  playBtn.textContent = 'â–¶ Play';
  vinyl.classList.remove('playing');
});
player.addEventListener('ended', () => {
  isPlaying = false;
  playBtn.textContent = 'â–¶ Play';
  vinyl.classList.remove('playing');
  updateProgressUI();
});

/* time updates */
player.addEventListener('timeupdate', () => { if (!dragging) updateProgressUI(); });
player.addEventListener('loadedmetadata', () => {
  timeRight.textContent = formatTime(player.duration || 0);
  updateProgressUI();
});

/* update progress UI */
function updateProgressUI() {
  const cur = player.currentTime || 0;
  const dur = player.duration || 1;
  const pct = Math.max(0, Math.min(100, (cur / dur) * 100));
  trackFilled.style.width = pct + '%';
  // position thumb
  const rect = track.getBoundingClientRect();
  const x = rect.left + (pct/100) * rect.width;
  thumb.style.left = `${(pct)}%`;
  thumb.classList.remove('hidden');
  timeLeft.textContent = formatTime(cur);
  timeDisplay.textContent = formatTime(cur);
}

/* -------------------------
   Scrubbing (modern slider)
   ------------------------- */
function setSeekFromPosition(clientX) {
  const rect = track.getBoundingClientRect();
  let x = clientX - rect.left;
  if (x < 0) x = 0;
  if (x > rect.width) x = rect.width;
  const pct = x / rect.width;
  const time = (player.duration || 1) * pct;
  // update UI live (without committing)
  trackFilled.style.width = (pct*100) + '%';
  thumb.style.left = (pct*100) + '%';
  tooltip.textContent = formatTime(time);
  tooltip.style.left = (pct*100) + '%';
  return time;
}

/* pointer handling */
function onPointerDown(e) {
  if (!player.duration) return;
  e.preventDefault();
  dragging = true;
  if (!audioCtx) ensureAudio();
  track.setPointerCapture(e.pointerId);
  const seekTime = setSeekFromPosition(e.clientX);
  tooltip.classList.add('visible');
  thumb.classList.remove('hidden');
  // optionally pause while dragging? Keep playing â€” we'll update time on finalize
  // store last pointer id
  track._activePointer = e.pointerId;
}
function onPointerMove(e) {
  if (!dragging) {
    // hover - show tooltip (non-touch)
    if (e.pointerType === 'mouse') {
      if (!player.duration) return;
      const rect = track.getBoundingClientRect();
      let x = e.clientX - rect.left;
      if (x < 0) x = 0;
      if (x > rect.width) x = rect.width;
      const pct = x / rect.width;
      const time = (player.duration || 1) * pct;
      tooltip.textContent = formatTime(time);
      tooltip.style.left = (pct*100) + '%';
      tooltip.classList.add('visible');
      thumb.classList.remove('hidden');
    }
    return;
  }
  if (track._activePointer !== e.pointerId) return;
  const t = setSeekFromPosition(e.clientX);
  // live-preview: update timeDisplay (optional) but don't commit to audio until pointerup
  timeDisplay.textContent = formatTime(t);
}
function onPointerUp(e) {
  if (dragging && track._activePointer === e.pointerId) {
    const t = setSeekFromPosition(e.clientX);
    player.currentTime = t;
    tooltip.classList.remove('visible');
    dragging = false;
    track.releasePointerCapture(e.pointerId);
  } else {
    // If pointerup happened but we weren't dragging, hide tooltip if visible
    tooltip.classList.remove('visible');
  }
}

/* click to seek (single click) */
function onTrackClick(e) {
  if (!player.duration) return;
  const t = setSeekFromPosition(e.clientX);
  player.currentTime = t;
}

/* keyboard accessibility for track (left/right seek) */
track.addEventListener('keydown', (ev) => {
  if (!player.duration) return;
  let handled = false;
  if (ev.key === 'ArrowRight') {
    player.currentTime = Math.min(player.duration, player.currentTime + 5);
    handled = true;
  } else if (ev.key === 'ArrowLeft') {
    player.currentTime = Math.max(0, player.currentTime - 5);
    handled = true;
  } else if (ev.key === 'Home') {
    player.currentTime = 0; handled = true;
  } else if (ev.key === 'End') {
    player.currentTime = player.duration; handled = true;
  }
  if (handled) {
    ev.preventDefault();
    updateProgressUI();
  }
});

/* attach pointer events */
track.addEventListener('pointerdown', onPointerDown);
track.addEventListener('pointermove', onPointerMove);
track.addEventListener('pointerup', onPointerUp);
track.addEventListener('pointerleave', () => { if (!dragging) tooltip.classList.remove('visible'); });
track.addEventListener('click', onTrackClick);

/* Touch: pointer events handle touch as well (supported). For older browsers we could add touch handlers. */

/* hide tooltip on scroll or blur */
window.addEventListener('blur', () => { tooltip.classList.remove('visible'); });

/* -------------------------
   Visualizer - bars (monochrome)
   ------------------------- */
const vizCanvas = document.getElementById('vizCanvas');
const vizCtx = vizCanvas.getContext('2d');
function visualize(){
  if (!analyser) return;
  const WIDTH = vizCanvas.width = vizCanvas.clientWidth * devicePixelRatio;
  const HEIGHT = vizCanvas.height = vizCanvas.clientHeight * devicePixelRatio;
  const bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);

  function draw() {
    rafId = requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    vizCtx.clearRect(0,0,WIDTH,HEIGHT);

    const barWidth = (WIDTH / bufferLength) * 1.1;
    let x = 0;
    for (let i = 0; i < bufferLength; i++){
      const v = dataArray[i] / 255; // 0..1
      const barHeight = Math.max(2, v * HEIGHT * 0.9);
      const alpha = 0.15 + (v * 0.85);
      vizCtx.fillStyle = `rgba(255,255,255,${alpha})`;
      vizCtx.fillRect(x, HEIGHT - barHeight, Math.floor(barWidth), Math.floor(barHeight));
      x += barWidth + 2;
    }
  }
  draw();
}

/* -------------------------
   Particles
   ------------------------- */
const particleCanvas = document.getElementById('particles');
const pCtx = particleCanvas.getContext('2d');
let particles = [];
function resizeParticles(){
  particleCanvas.width = innerWidth * devicePixelRatio;
  particleCanvas.height = innerHeight * devicePixelRatio;
  pCtx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
function initParticles(){
  resizeParticles();
  particles = [];
  const count = Math.max(30, Math.floor(window.innerWidth/24));
  for (let i=0;i<count;i++){
    particles.push({
      x: Math.random()*innerWidth,
      y: Math.random()*innerHeight,
      r: 0.6 + Math.random()*2.2,
      vy: 0.02 + Math.random()*0.35,
      alpha: 0.03 + Math.random()*0.08
    });
  }
}
function drawParticles(){
  pCtx.clearRect(0,0,particleCanvas.width, particleCanvas.height);
  pCtx.save();
  pCtx.scale(1/devicePixelRatio, 1/devicePixelRatio);
  for (const p of particles){
    p.y -= p.vy;
    if (p.y < -10) p.y = innerHeight + 10;
    pCtx.beginPath();
    pCtx.fillStyle = `rgba(255,255,255,${p.alpha})`;
    pCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    pCtx.fill();
  }
  pCtx.restore();
  requestAnimationFrame(drawParticles);
}
window.addEventListener('resize', () => { initParticles(); adjustCanvasSizes(); });
initParticles();
drawParticles();

/* -------------------------
   Responsive & misc
   ------------------------- */
const bgImg = document.getElementById('bgImage');
const bgFill = document.getElementById('bgFill');

function adjustCanvasSizes(){
  // ensure visualizer canvas pixel ratio
  vizCanvas.width = vizCanvas.clientWidth * devicePixelRatio;
  vizCanvas.height = vizCanvas.clientHeight * devicePixelRatio;
}
adjustCanvasSizes();

/* Night Mode */
function toggleNight(){
  document.body.classList.toggle('night');
}

/* Resume audio context on first gesture */
document.body.addEventListener('click', function initOnce(){
  if (!audioCtx) {
    try { ensureAudio(); if (audioCtx.state === 'suspended') audioCtx.resume(); } catch(e){}
  }
  document.body.removeEventListener('click', initOnce);
}, {once:true});

/* entrance animation */
window.addEventListener('load', () => {
  document.querySelectorAll('.card').forEach((c,i) => {
    c.style.opacity = 0; c.style.transform = 'translateY(8px)';
    setTimeout(()=>{ c.style.transition='opacity .6s ease, transform .6s cubic-bezier(.2,.9,.2,1)'; c.style.opacity=1; c.style.transform='translateY(0)'; }, 220 + i*60);
  });
});

/* cleanup */
window.addEventListener('beforeunload', () => { if (rafId) cancelAnimationFrame(rafId); });

/* initialize progress UI initially */
updateProgressUI();

</script>

</body>
</html>
